<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manakish Dough & Toppings Calculator</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
                        body {
                          font-family: "Montserrat", Arial, sans-serif;
                          max-width: 800px;
                          margin: 0 auto;
                          padding: 20px;
                          line-height: 1.5;
                          background-color: #faf8f3;
                          color: #333;
                        }

                        h1,
                        h2,
                        h3,
                        h4 {
                          font-family: "Bebas Neue", sans-serif;
                          letter-spacing: 1px;
                          color: #e94e4e;
                          margin-top: -35px;
                          margin-bottom: 5px;
                        }

                        h1 {
                          text-align: center;
                          margin-bottom: 0.5em;
                          font-size: 70px;
                          text-transform: uppercase;
                          width: fit-content;
                          margin-left: auto;
                          margin-right: auto;
                        }

                        .arabic-title {
                          font-family: "Cairo", sans-serif;
                          text-align: center;
                          font-size: 60px;
                          margin-top: 10px;
                          margin-bottom: 10px;
                          color: #e94e4e;
                        }

                        .subtitle {
                          text-align: center;
                          font-size: 18px;
                          color: #e94e4e;
                          text-transform: uppercase;
                          margin-top: -45px;
                          letter-spacing: 0.05em;
                          margin-bottom: 20px;
                        }

                        .calculator-section {
                          background-color: #fff;
                          border-radius: 8px;
                          padding: 20px;
                          margin-bottom: 30px;
                          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                          border-top: 3px solid #e94e4e;
                        }

                        .section-title {
                          font-size: 24px;
                          margin-top: 0;
                          color: #e94e4e;
                          display: flex;
                          align-items: center;
                        }

                        .section-title::after {
                          content: "";
                          flex-grow: 1;
                          height: 1px;
                          background: #e94e4e;
                          opacity: 0.3;
                          margin-left: 15px;
                        }

                        .show-price-button {
                          margin-bottom: 20px;
                        }

                        table {
                          width: 100%;
                          border-collapse: collapse;
                          margin: 20px 0;
                        }

                        th,
                        td {
                          padding: 12px 10px;
                          text-align: left;
                          border-bottom: 1px solid #eee;
                        }

                        th {
                          background-color: #f9f9f9;
                          font-weight: 500;
                          color: #e94e4e;
                        }

                        input {
                          width: 100%;
                          padding: 10px;
                          box-sizing: border-box;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-family: "Montserrat", Arial, sans-serif;
                        }

                        input:focus {
                          outline: none;
                          border-color: #e94e4e;
                        }

                        .controls {
                          display: flex;
                          gap: 20px;
                          margin: 20px 0;
                        }

                        .control-group {
                          flex: 1;
                        }

                        label {
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          color: #555;
                        }

                        .results {
                          background-color: #fff;
                          border-radius: 8px;
                          padding: 20px;
                          margin-top: 30px;
                          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                          border-top: 3px solid #e94e4e;
                        }

                        .total-row {
                          font-weight: 500;
                          background-color: #f9f9f9;
                        }

                        button {
                          background-color: #e94e4e;
                          color: white;
                          border: none;
                          padding: 10px 15px;
                          border-radius: 4px;
                          cursor: pointer;
                          font-size: 16px;
                          font-family: "Montserrat", Arial, sans-serif;
                          transition: background-color 0.2s;
                          margin: 5px; /* Added margin for spacing between new buttons */
                        }

                        button:hover {
                          background-color: #d43e3e;
                        }

                        .ingredient-controls {
                          display: flex;
                          justify-content: space-between;
                          margin-top: 20px;
                          flex-wrap: wrap;
                          gap: 10px;
                        }

                        .ingredient-input-group {
                          display: flex;
                          gap: 10px;
                          flex-wrap: wrap;
                        }

                        .ingredient-input-group input {
                          width: auto;
                          flex: 1;
                          min-width: 120px;
                        }

                        .header-logo {
                          text-align: center;
                          margin-bottom: 20px;
                        }

                        .recipe-actions {
                          /* Style for the new button container */
                          text-align: center;
                          margin: 30px auto;
                          display: flex;
                          justify-content: center;
                          gap: 12px;
                          flex-wrap: wrap;
                        }

                        .recipe-actions button {
                          flex: 1 1 160px;
                          max-width: 200px;
                          padding: 10px 16px;
                          font-size: 15px;
                          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                          transition: transform 0.2s ease;
                        }

                        .recipe-actions button:hover {
                          transform: translateY(-1px);
                        }

                        .dotted-divider {
                          border: none;
                          border-top: 2px dotted #e94e4e;
                          opacity: 0.3;
                          margin: 25px 0;
                        }

                        .batch-controls {
                          margin-top: 20px;
                          padding-top: 20px;
                          border-top: 1px solid #eee;
                        }

                        .indicator {
                          display: inline-block;
                          padding: 2px 6px;
                          border-radius: 3px;
                          font-size: 12px;
                          text-transform: uppercase;
                          font-weight: 500;
                          margin-left: 8px;
                        }

                        .hydration-low {
                          background-color: #f9f1e8;
                          color: #e94e4e;
                        }

                        .hydration-medium {
                          background-color: #f1f1f1;
                          color: #666;
                        }

                        .hydration-high {
                          background-color: #e8f4f9;
                          color: #3399ff;
                        }

                        .legend {
                          display: flex;
                          justify-content: center;
                          gap: 20px;
                          margin-top: 30px;
                          font-size: 12px;
                          color: #777;
                        }

                        .legend-item {
                          display: flex;
                          align-items: center;
                        }

                        .tabs {
                          display: flex;
                          border-bottom: 1px solid #ddd;
                          margin-bottom: 20px;
                        }

                        .tab {
                          padding: 10px 20px;
                          cursor: pointer;
                          border: 1px solid transparent;
                          border-bottom: none;
                          margin-right: 5px;
                          border-top-left-radius: 4px;
                          border-top-right-radius: 4px;
                          font-weight: 500;
                          transition: all 0.2s;
                        }

                        .tab.active {
                          border-color: #ddd;
                          background-color: #fff;
                          color: #e94e4e;
                          position: relative;
                        }

                        .tab.active::after {
                          content: "";
                          position: absolute;
                          bottom: -1px;
                          left: 0;
                          right: 0;
                          height: 1px;
                          background-color: #fff;
                        }

                        .tab-content {
                          display: none;
                        }

                        .tab-content.active {
                          display: block;
                        }

                        .topping-card {
                          background-color: #f9f9f9;
                          border-radius: 8px;
                          padding: 15px;
                          margin-bottom: 20px;
                          border-left: 3px solid #e94e4e;
                        }

                        .topping-card h4 {
                          margin-top: 0;
                          display: flex;
                          align-items: center;
                        }

                        .servings-info {
                          margin-top: 15px;
                          font-weight: 500;
                          color: #555;
                        }

                        .price-column {
                          width: 100px;
                        }

                        .small-input {
                          width: 80px;
                        }

                        .total-price {
                          font-family: "Bebas Neue", sans-serif;
                          font-size: 24px;
                          color: #e94e4e;
                          text-align: right;
                          margin-top: 20px;
                        }

                        .warning {
                          color: red;
                          font-weight: bold;
                          margin-top: 10px;
                        }

                        #manakish-title {
                          font-family: "Bebas Neue", sans-serif;
                          font-size: 100px;
                          margin-bottom: 10px;
                          letter-spacing: 7px;
                          display: inline-block;
                        }

                        .header-logo {
                          text-align: center;
                          margin-bottom: 10px;
                        }

                        .arabic-title {
                          margin-bottom: 10px;
                        }

                        .subtitle {
                          margin-bottom: 40px; /* Increased original margin to make space for buttons */
                        }

                        @media (max-width: 600px) {
                          .controls {
                            flex-direction: column;
                            gap: 10px;
                          }

                          .ingredient-input-group {
                            flex-direction: column;
                          }

                          .tabs {
                            flex-wrap: wrap;
                          }

                          .tab {
                            margin-bottom: 5px;
                          }
                          .recipe-actions button {
                            /* Ensure buttons stack nicely on mobile */
                            display: block;
                            width: calc(100% - 10px); /* Full width with margin consideration */
                            margin-left: auto;
                            margin-right: auto;
                            margin-bottom: 10px;
                          }
                        }

            .toast {
              position: fixed;
              bottom: 24px;
              left: 50%;
              transform: translateX(-50%) translateY(10px);
              background-color: #333; /* dark grey background */
              color: #fff;
              padding: 14px 24px;
              border-radius: 10px;
              font-size: 14px;
              opacity: 0;
              pointer-events: none;
              box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
              transition: opacity 0.4s ease, transform 0.4s ease;
              z-index: 9999;
              font-family: "Montserrat", sans-serif;
            }

            .toast.show {
              opacity: 1;
              pointer-events: auto;
              transform: translateX(-50%) translateY(0);
            }
      
@media print {
  body {
    background: white !important;
    color: black !important;
    font-size: 12pt;
    padding: 20px;
  }

  /* Hide everything except summary */
  body * {
    visibility: hidden !important;
  }

  #summaryTab,
  #summaryTab * {
    visibility: visible !important;
  }

  #summaryTab {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
  }

  .recipe-actions,
  .tabs,
  footer {
    display: none !important;
  }

  #printableDoughRecipe {
    display: block !important;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 20px;
  }

  th,
  td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }

  th {
    background: #eee;
  }

  .total-row {
    font-weight: bold;
  }

  .total-price {
    font-size: 16pt;
    font-weight: bold;
    margin-top: 20px;
  }
}


      
      button i {
        margin-right: 8px;
      }


                        }
    </style>
  </head>
  <body>
    <div class="header-logo">
      <div class="arabic-title">مناقيش</div>
      <h1 id="manakish-title">MANAKISH</h1>
      <div class="subtitle">TRADITIONAL LEBANESE FLATBREAD</div>
      <div class="recipe-actions">
      <!-- <button id="saveRecipeButton"> 
          <i class="fas fa-save"></i> Save Recipe
        </button> -->
        <button id="shareRecipeButton">
          <i class="fas fa-share-alt"></i> Share Recipe
        </button>
        <button id="resetToDefaultButton">
          <i class="fas fa-undo-alt"></i> Default
        </button>
        <button id="printRecipeButton"><i class="fas fa-print"></i> Print Recipe</button>

      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="doughTab">DOUGH</div>
      <div class="tab" data-tab="toppingsTab">TOPPINGS</div>
      <div class="tab" data-tab="summaryTab">SUMMARY</div>
    </div>

    <div id="doughTab" class="tab-content active">
      <div class="calculator-section">
        <h3 class="section-title">DOUGH CALCULATOR</h3>

        <div class="controls">
          <div class="control-group">
            <label for="doughBallWeight">Dough Ball Weight (g):</label>
            <input type="number" id="doughBallWeight" value="85" min="1" />
          </div>
          <div class="control-group">
            <label for="doughBallCount">Number of Dough Balls:</label>
            <input type="number" id="doughBallCount" value="10" min="1" />
          </div>
        </div>

        <div>
          <label
            >Total Dough Weight: <span id="totalDoughWeight">850</span> g</label
          >
        </div>

        <div class="batch-controls">
          <div class="controls">
            <div class="control-group">
              <label for="numberOfBatches">Divide Recipe into Batches:</label>
              <input type="number" id="numberOfBatches" value="1" min="1" />
            </div>
          </div>
          <div>
            <label
              >Each Batch Weight: <span id="batchWeight">850</span> g</label
            >
          </div>
        </div>

        <hr class="dotted-divider" />

        <h3 class="section-title">RECIPE INGREDIENTS</h3>
        <button id="toggleDoughPrices" class="show-price-button">
          Hide Prices
        </button>
        <table id="ingredientsTable">
          <thead>
            <tr>
              <th>Ingredient</th>
              <th>Base Recipe (g)</th>
              <th>Calculated Amount</th>
              <th>Per Batch</th>
              <th class="price-column">Price/kg (£)</th>
              <th class="price-column">Actions</th>
            </tr>
          </thead>
          <tbody id="ingredientsList"></tbody>
          <tfoot>
            <tr class="total-row">
              <td>Total</td>
              <td id="baseTotal">854g</td>
              <td id="calculatedTotal">854g</td>
              <td id="batchTotal">854g</td>
              <td id="doughTotalPrice">£0.00</td>
              <td></td>
            </tr>
          </tfoot>
        </table>

        <div class="ingredient-controls">
          <div class="ingredient-input-group">
            <input
              type="text"
              id="newIngredientName"
              placeholder="Ingredient name"
            />
            <input
              type="number"
              id="newIngredientAmount"
              placeholder="Amount (g)"
              min="0"
              step="0.1"
            />
            <input
              type="number"
              id="newIngredientPrice"
              placeholder="Price/kg (£)"
              min="0"
              step="0.01"
            />
            <button id="addIngredientButton"><i class="fas fa-plus-circle"></i> Add Ingredient</button>

          </div>
        </div>
      </div>

      <div class="results">
        <h3 class="section-title" style="margin-bottom: 16px">
          RECIPE FOR&nbsp;<span id="resultDoughBalls">10</span>&nbsp;MANAKISH
        </h3>
        <p>Each dough ball: <span id="resultDoughBallWeight">85</span>g</p>
        <p>
          Dough Hydration: <span id="doughHydration">60%</span>
          <span id="hydrationIndicator" class="indicator hydration-medium"
            >Medium</span
          >
        </p>

        <hr class="dotted-divider" />

        <div id="batchResults">
          <h4>COMPLETE RECIPE</h4>
          <table>
            <thead>
              <tr>
                <th>Ingredient</th>
                <th>Amount</th>
                <th class="price-column">Cost (£)</th>
              </tr>
            </thead>
            <tbody id="recipeResults"></tbody>
            <tfoot>
              <tr class="total-row">
                <td>Total Dough</td>
                <td id="resultTotal">850g</td>
                <td id="recipeTotalPrice">£0.00</td>
              </tr>
            </tfoot>
          </table>
        </div>

        <hr class="dotted-divider" />

        <div id="singleBatchSection">
          <h4>
            SINGLE BATCH (<span id="batchNumber">1</span> of
            <span id="totalBatches">1</span>)
          </h4>
          <table>
            <thead>
              <tr>
                <th>Ingredient</th>
                <th>Amount</th>
                <th class="price-column">Cost (£)</th>
              </tr>
            </thead>
            <tbody id="batchRecipeResults"></tbody>
            <tfoot>
              <tr class="total-row">
                <td>Batch Dough</td>
                <td id="batchResultTotal">850g</td>
                <td id="batchRecipeTotalPrice">£0.00</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>

    <div id="toppingsTab" class="tab-content">
      <div class="calculator-section">
        <h3 class="section-title">TOPPINGS CALCULATOR</h3>

        <p>
          Based on <span id="toppingsDoughBalls">10</span> manakish. Adjust
          quantities per manakish as needed.
        </p>
        <button id="toggleToppingPrices" class="show-price-button">
          Hide Prices
        </button>
        <div class="topping-card">
          <h4>ZAATAR</h4>
          <table id="zaatarTable">
            <thead>
              <tr>
                <th>Ingredient</th>
                <th>Per Manakish (g)</th>
                <th>Total Amount (g)</th>
                <th class="price-column">Price/kg (£)</th>
                <th class="price-column">Total Cost (£)</th>
                <th class="price-column">Actions</th>
              </tr>
            </thead>
            <tbody id="zaatarIngredients"></tbody>
            <tfoot>
              <tr class="total-row">
                <td>Total</td>
                <td></td>
                <td id="zaatarTotalAmount">0g</td>
                <td></td>
                <td id="zaatarTotalPrice">£0.00</td>
              </tr>
            </tfoot>
          </table>

          <div class="ingredient-controls" id="zaatarControls">
            <div class="ingredient-input-group">
              <input
                type="text"
                id="zaatarNewIngredientName"
                placeholder="Ingredient name"
              />
              <input
                type="number"
                id="zaatarNewIngredientAmount"
                placeholder="Amount (g)"
                min="0"
                step="0.1"
              />
              <input
                type="number"
                id="zaatarNewIngredientPrice"
                placeholder="Price/kg (£)"
                min="0"
                step="0.01"
              />
              <button id="addZaatarIngredientButton"><i class="fas fa-plus-circle"></i> Add Ingredient</button>

            </div>
          </div>

          <div class="servings-info">
            <label for="zaatarServings">Number of Zaatar Manakish:</label>
            <input
              type="number"
              id="zaatarServings"
              value="0"
              min="0"
              class="small-input"
            />
          </div>
        </div>

        <div class="topping-card">
          <h4>CHEESE</h4>
          <table id="cheeseTable">
            <thead>
              <tr>
                <th>Ingredient</th>
                <th>Per Manakish (g)</th>
                <th>Total Amount (g)</th>
                <th>Price/kg (£)</th>
                <th>Total Cost (£)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="cheeseIngredients"></tbody>
            <tfoot>
              <tr class="total-row">
                <td>Total</td>
                <td></td>
                <td id="cheeseTotalAmount">0g</td>
                <td></td>
                <td id="cheeseTotalPrice">£0.00</td>
              </tr>
            </tfoot>
          </table>

          <div class="ingredient-controls" id="cheeseControls">
            <div class="ingredient-input-group">
              <input
                type="text"
                id="cheeseNewIngredientName"
                placeholder="Ingredient name"
              />
              <input
                type="number"
                id="cheeseNewIngredientAmount"
                placeholder="Amount (g)"
                min="0"
                step="0.1"
              />
              <input
                type="number"
                id="cheeseNewIngredientPrice"
                placeholder="Price/kg (£)"
                min="0"
                step="0.01"
              />
              <button id="addCheeseIngredientButton"><i class="fas fa-plus-circle"></i> Add Ingredient</button>

            </div>
          </div>

          <div class="servings-info">
            <label for="cheeseServings">Number of Cheese Manakish:</label>
            <input
              type="number"
              id="cheeseServings"
              value="0"
              min="0"
              class="small-input"
            />
          </div>
        </div>

        <div class="topping-card">
          <h4>COCKTAIL</h4>
          <table id="cocktailTable">
            <thead>
              <tr>
                <th>Ingredient</th>
                <th>Per Manakish (g)</th>
                <th>Total Amount (g)</th>
                <th>Price/kg (£)</th>
                <th>Total Cost (£)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="cocktailIngredients"></tbody>
            <tfoot>
              <tr class="total-row">
                <td>Total</td>
                <td></td>
                <td id="cocktailTotalAmount">0g</td>
                <td></td>
                <td id="cocktailTotalPrice">£0.00</td>
              </tr>
            </tfoot>
          </table>

          <div class="ingredient-controls" id="cocktailControls">
            <div class="ingredient-input-group">
              <input
                type="text"
                id="cocktailNewIngredientName"
                placeholder="Ingredient name"
              />
              <input
                type="number"
                id="cocktailNewIngredientAmount"
                placeholder="Amount (g)"
                min="0"
                step="0.1"
              />
              <input
                type="number"
                id="cocktailNewIngredientPrice"
                placeholder="Price/kg (£)"
                min="0"
                step="0.01"
              />
<button id="addCocktailIngredientButton"><i class="fas fa-plus-circle"></i> Add Ingredient</button>
            </div>
          </div>

          <div class="servings-info">
            <label for="cocktailServings">Number of Cocktail Manakish:</label>
            <input
              type="number"
              id="cocktailServings"
              value="0"
              min="0"
              class="small-input"
            />
          </div>
        </div>

        <div class="topping-card">
          <h4>LAHME</h4>
          <table id="lahmeTable">
            <thead>
              <tr>
                <th>Ingredient</th>
                <th>Per Manakish (g)</th>
                <th>Total Amount (g)</th>
                <th>Price/kg (£)</th>
                <th>Total Cost (£)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="lahmeIngredients"></tbody>
            <tfoot>
              <tr class="total-row">
                <td>Total</td>
                <td></td>
                <td id="lahmeTotalAmount">0g</td>
                <td></td>
                <td id="lahmeTotalPrice">£0.00</td>
              </tr>
            </tfoot>
          </table>

          <div class="ingredient-controls" id="lahmeControls">
            <div class="ingredient-input-group">
              <input
                type="text"
                id="lahmeNewIngredientName"
                placeholder="Ingredient name"
              />
              <input
                type="number"
                id="lahmeNewIngredientAmount"
                placeholder="Amount (g)"
                min="0"
                step="0.1"
              />
              <input
                type="number"
                id="lahmeNewIngredientPrice"
                placeholder="Price/kg (£)"
                min="0"
                step="0.01"
              />
<button id="addLahmeIngredientButton"><i class="fas fa-plus-circle"></i> Add Ingredient</button>
            </div>
          </div>

          <div class="servings-info">
            <label for="lahmeServings">Number of Lahme Manakish:</label>
            <input
              type="number"
              id="lahmeServings"
              value="0"
              min="0"
              class="small-input"
            />
          </div>
        </div>

        <div class="topping-card">
          <h4>CHOCO-BANANA</h4>
          <table id="chocoTable">
            <thead>
              <tr>
                <th>Ingredient</th>
                <th>Per Manakish (g)</th>
                <th>Total Amount (g)</th>
                <th class="price-column">Price/kg (£)</th>
                <th class="price-column">Total Cost (£)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="chocoIngredients"></tbody>
            <tfoot>
              <tr class="total-row">
                <td>Total</td>
                <td></td>
                <td id="chocoTotalAmount">0g</td>
                <td></td>
                <td id="chocoTotalPrice">£0.00</td>
              </tr>
            </tfoot>
          </table>

          <div class="ingredient-controls" id="chocoControls">
            <div class="ingredient-input-group">
              <input
                type="text"
                id="chocoNewIngredientName"
                placeholder="Ingredient name"
              />
              <input
                type="number"
                id="chocoNewIngredientAmount"
                placeholder="Amount (g)"
                min="0"
                step="0.1"
              />
              <input
                type="number"
                id="chocoNewIngredientPrice"
                placeholder="Price/kg (£)"
                min="0"
                step="0.01"
              />
              <button id="addChocoIngredientButton">Add Ingredient</button>
            </div>
          </div>

          <div class="servings-info">
            <label for="chocoServings">Number of Choco-Banana Manakish:</label>
            <input
              type="number"
              id="chocoServings"
              value="0"
              min="0"
              class="small-input"
            />
          </div>
        </div>

        <div class="total-price">
          Total Toppings Cost: <span id="allToppingsCost">£0.00</span>
        </div>
        <p id="toppingsMismatchWarning" class="warning" style="display: none">
          Warning: The total number of manakish in the toppings section does not
          match the number of dough balls.
        </p>
      </div>
    </div>

    <div id="summaryTab" class="tab-content">
      <div class="calculator-section">
        <h3 class="section-title">SUMMARY</h3>
        
        <div id="printableDoughRecipe" class="calculator-section" style="display: none;">
  <h3 class="section-title">DOUGH RECIPE</h3>
  <table>
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Amount (g)</th>
        <th>Baker’s %</th>
      </tr>
    </thead>
    <tbody id="printableDoughBody"></tbody>
  </table>
</div>


        <table>
          <thead>
            <tr>
              <th>Category</th>
              <th>Quantity</th>
              <th>Cost (£)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Dough</td>
              <td><span id="summaryDoughBalls">10</span> manakish</td>
              <td id="summaryDoughCost">£0.00</td>
            </tr>
            <tr>
              <td>Zaatar Topping</td>
              <td><span id="summaryZaatarCount">0</span> manakish</td>
              <td id="summaryZaatarCost">£0.00</td>
            </tr>
            <tr>
              <td>Cheese Topping</td>
              <td><span id="summaryCheeseCount">0</span> manakish</td>
              <td id="summaryCheesesCost">£0.00</td>
            </tr>
            <tr>
              <td>Cocktail Topping</td>
              <td><span id="summaryCocktailCount">0</span> manakish</td>
              <td id="summaryCocktailCost">£0.00</td>
            </tr>
            <tr>
              <td>Lahme Topping</td>
              <td><span id="summaryLahmeCount">0</span> manakish</td>
              <td id="summaryLahmeCost">£0.00</td>
            </tr>
            <tr>
              <td>Choco-Banana Topping</td>
              <td><span id="summaryChocoCount">0</span> manakish</td>
              <td id="summaryChocoCost">£0.00</td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="total-row">
              <td>Total</td>
              <td><span id="summaryTotalCount">0</span> manakish</td>
              <td id="summaryTotalCost">£0.00</td>
            </tr>
          </tfoot>
        </table>

        <div class="servings-info">
          <p>Cost per manakish: <span id="costPerManakish">£0.00</span></p>
        </div>

        <hr class="dotted-divider" />

        <h3 class="section-title">TOTAL INGREDIENTS SHOPPING LIST</h3>

        <table>
          <thead>
            <tr>
              <th>Ingredient</th>
              <th>Total Amount</th>
              <th>Cost (£)</th>
            </tr>
          </thead>
          <tbody id="shoppingList"></tbody>
          <tfoot>
            <tr class="total-row">
              <td>Total</td>
              <td></td>
              <td id="shoppingListTotal">£0.00</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <script>
      // --- DEFAULT DATA ---
      const defaultInitialDoughBallWeight = 85;
      const defaultInitialDoughBallCount = 10;
      const defaultInitialNumberOfBatches = 1;
      const defaultInitialServings = {
        zaatar: 0,
        cheese: 0,
        cocktail: 0,
        lahme: 0,
        choco: 0,
      };

      const defaultIngredientsData = [
        { name: "Flour", amount: 500, price: 1.2 },
        { name: "Water", amount: 300, price: 0.0 },
        { name: "Instant Yeast", amount: 4, price: 10.0 },
        { name: "Sugar", amount: 20, price: 1.5 },
        { name: "Salt", amount: 15, price: 1.0 },
        { name: "Vegetable Oil", amount: 15, price: 2.5 },
      ];

      const defaultToppingsData = {
        zaatar: [
          { name: "Zaatar Mix", amount: 15, price: 15.0 },
          { name: "Olive Oil", amount: 10, price: 8.0 },
        ],
        cheese: [{ name: "Akawi Cheese", amount: 40, price: 12.0 }],
        cocktail: [
          { name: "Zaatar Mix", amount: 8, price: 15.0 },
          { name: "Olive Oil", amount: 5, price: 8.0 },
          { name: "Akawi Cheese", amount: 20, price: 12.0 },
        ],
        lahme: [
          { name: "Beef/Lamb Mince", amount: 30, price: 10.0 },
          { name: "Onion", amount: 10, price: 1.5 },
          { name: "Tomato", amount: 10, price: 2.8 },
        ],
        choco: [
          { name: "Chocolate Spread", amount: 20, price: 6.0 },
          { name: "Banana", amount: 25, price: 1.8 },
          { name: "Crushed Nuts", amount: 5, price: 12.0 },
        ],
      };

      // --- APPLICATION STATE ---
      let ingredients = JSON.parse(JSON.stringify(defaultIngredientsData));
      let toppings = JSON.parse(JSON.stringify(defaultToppingsData));
      let showPrices = false;

      // --- DOM ELEMENTS (cached for performance) ---
      const doughBallWeightInput = document.getElementById("doughBallWeight");
      const doughBallCountInput = document.getElementById("doughBallCount");
      const numberOfBatchesInput = document.getElementById("numberOfBatches");
      const zaatarServingsInput = document.getElementById("zaatarServings");
      const cheeseServingsInput = document.getElementById("cheeseServings");
      const cocktailServingsInput = document.getElementById("cocktailServings");
      const lahmeServingsInput = document.getElementById("lahmeServings");
      const chocoServingsInput = document.getElementById("chocoServings");
      const totalDoughWeightLabel = document.getElementById("totalDoughWeight");
      const batchWeightLabel = document.getElementById("batchWeight");
      const resultDoughBallsLabel = document.getElementById("resultDoughBalls");
      const resultDoughBallWeightLabel = document.getElementById(
        "resultDoughBallWeight"
      );
      const batchNumberLabel = document.getElementById("batchNumber");
      const totalBatchesLabel = document.getElementById("totalBatches");
      const ingredientsList = document.getElementById("ingredientsList");
      const baseTotalLabel = document.getElementById("baseTotal");
      const calculatedTotalLabel = document.getElementById("calculatedTotal");
      const batchTotalLabel = document.getElementById("batchTotal");
      const doughTotalPriceLabel = document.getElementById("doughTotalPrice");
      const recipeResults = document.getElementById("recipeResults");
      const batchRecipeResults = document.getElementById("batchRecipeResults");
      const resultTotalLabel = document.getElementById("resultTotal");
      const recipeTotalPriceLabel = document.getElementById("recipeTotalPrice");
      const batchResultTotalLabel = document.getElementById("batchResultTotal");
      const batchRecipeTotalPriceLabel = document.getElementById(
        "batchRecipeTotalPrice"
      );
      const doughHydrationLabel = document.getElementById("doughHydration");
      const hydrationIndicator = document.getElementById("hydrationIndicator");
      const toppingsDoughBallsLabel =
        document.getElementById("toppingsDoughBalls");
      const allToppingsCostLabel = document.getElementById("allToppingsCost");
      const toppingsMismatchWarning = document.getElementById(
        "toppingsMismatchWarning"
      );
      const summaryDoughBallsLabel =
        document.getElementById("summaryDoughBalls");
      const summaryDoughCostLabel = document.getElementById("summaryDoughCost");
      const summaryZaatarCountLabel =
        document.getElementById("summaryZaatarCount");
      const summaryZaatarCostLabel =
        document.getElementById("summaryZaatarCost");
      const summaryCheeseCountLabel =
        document.getElementById("summaryCheeseCount");
      const summaryCheesesCostLabel =
        document.getElementById("summaryCheesesCost");
      const summaryCocktailCountLabel = document.getElementById(
        "summaryCocktailCount"
      );
      const summaryCocktailCostLabel = document.getElementById(
        "summaryCocktailCost"
      );
      const summaryLahmeCountLabel =
        document.getElementById("summaryLahmeCount");
      const summaryLahmeCostLabel = document.getElementById("summaryLahmeCost");
      const summaryChocoCountLabel =
        document.getElementById("summaryChocoCount");
      const summaryChocoCostLabel = document.getElementById("summaryChocoCost");
      const summaryTotalCountLabel =
        document.getElementById("summaryTotalCount");
      const summaryTotalCostLabel = document.getElementById("summaryTotalCost");
      const costPerManakishLabel = document.getElementById("costPerManakish");
      const shoppingListElem = document.getElementById("shoppingList");
      const shoppingListTotalLabel =
        document.getElementById("shoppingListTotal");
      const addIngredientButton = document.getElementById(
        "addIngredientButton"
      );
      const addZaatarIngredientButton = document.getElementById(
        "addZaatarIngredientButton"
      );
      const addCheeseIngredientButton = document.getElementById(
        "addCheeseIngredientButton"
      );
      const addCocktailIngredientButton = document.getElementById(
        "addCocktailIngredientButton"
      );
      const addLahmeIngredientButton = document.getElementById(
        "addLahmeIngredientButton"
      );
      const addChocoIngredientButton = document.getElementById(
        "addChocoIngredientButton"
      );
      const toggleDoughPricesButton =
        document.getElementById("toggleDoughPrices");
      const toggleToppingPricesButton = document.getElementById(
        "toggleToppingPrices"
      );
    //  const saveRecipeButton = document.getElementById("saveRecipeButton");
      const shareRecipeButton = document.getElementById("shareRecipeButton");
      const resetToDefaultButton = document.getElementById(
        "resetToDefaultButton"
      );

      // --- INITIALIZATION ---
      window.onload = function () {
        const loadedFromUrl = loadRecipeFromURL(); // Attempt to load from URL first
        if (!loadedFromUrl) {
          loadSavedRecipe(); // If not from URL, try localStorage
        }
        // If neither, defaults defined at the top of the script and in HTML inputs are used.

        loadIngredients();
        loadAllToppings();
        updateCalculations(); // This recalculates everything based on current data.

        // Event listeners
        doughBallWeightInput.addEventListener("input", updateCalculations);
        doughBallCountInput.addEventListener("input", updateCalculations);
        numberOfBatchesInput.addEventListener("input", updateCalculations);

        addIngredientButton.addEventListener("click", addIngredient);
        addZaatarIngredientButton.addEventListener("click", () =>
          addToppingIngredient("zaatar")
        );
        addCheeseIngredientButton.addEventListener("click", () =>
          addToppingIngredient("cheese")
        );
        addCocktailIngredientButton.addEventListener("click", () =>
          addToppingIngredient("cocktail")
        );
        addLahmeIngredientButton.addEventListener("click", () =>
          addToppingIngredient("lahme")
        );
        addChocoIngredientButton.addEventListener("click", () =>
          addToppingIngredient("choco")
        );

        toggleDoughPricesButton.addEventListener("click", toggleDoughPrices);
        toggleToppingPricesButton.addEventListener(
          "click",
          toggleToppingPrices
        );

        zaatarServingsInput.addEventListener(
          "input",
          updateToppingsCalculations
        );
        cheeseServingsInput.addEventListener(
          "input",
          updateToppingsCalculations
        );
        cocktailServingsInput.addEventListener(
          "input",
          updateToppingsCalculations
        );
        lahmeServingsInput.addEventListener(
          "input",
          updateToppingsCalculations
        );
        chocoServingsInput.addEventListener(
          "input",
          updateToppingsCalculations
        );

        //saveRecipeButton.addEventListener("click", saveRecipe);
        shareRecipeButton.addEventListener("click", shareRecipe);
        resetToDefaultButton.addEventListener("click", resetToDefaults);
        printRecipeButton.addEventListener("click", () => {
  openTab("summaryTab");
  setTimeout(() => window.print(), 100); // allow tab switch to render
});


        

        document.querySelectorAll(".tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            openTab(this.dataset.tab);
          });
        });
      };

      // --- TAB NAVIGATION ---
      function openTab(tabName) {
        document
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"));
        document
          .querySelectorAll(".tab")
          .forEach((tab) => tab.classList.remove("active"));
        document.getElementById(tabName).classList.add("active");
        document
          .querySelector(`[data-tab="${tabName}"]`)
          .classList.add("active");
      }

      // --- RECIPE PERSISTENCE FUNCTIONS ---

    /*  function saveRecipe() {
      const currentRecipe = {
          doughBallWeight: parseFloat(doughBallWeightInput.value), 
          doughBallCount: parseFloat(doughBallCountInput.value),
          numberOfBatches: parseInt(numberOfBatchesInput.value),
          ingredients: JSON.parse(JSON.stringify(ingredients)),
          toppings: JSON.parse(JSON.stringify(toppings)),
          servings: {
            zaatar: parseInt(zaatarServingsInput.value) || 0,
            cheese: parseInt(cheeseServingsInput.value) || 0,
            cocktail: parseInt(cocktailServingsInput.value) || 0,
            lahme: parseInt(lahmeServingsInput.value) || 0,
            choco: parseInt(chocoServingsInput.value) || 0,
          },
        };
        try {
          localStorage.setItem(
            "manakishUserRecipe",
            JSON.stringify(currentRecipe)
          );
          showToast("Recipe saved successfully!");
        } catch (e) {
          console.error("Error saving recipe to localStorage:", e);
          showToast(
            "Could not save recipe. Storage might be full or unavailable."
          );
        }
      } */


function shareRecipe() {
  try {
    // Step 1: Build current recipe object
    const currentRecipe = {
      doughBallWeight: parseFloat(doughBallWeightInput.value),
      doughBallCount: parseFloat(doughBallCountInput.value),
      numberOfBatches: parseInt(numberOfBatchesInput.value),
      ingredients: JSON.parse(JSON.stringify(ingredients)),
      toppings: JSON.parse(JSON.stringify(toppings)),
      servings: {
        zaatar: parseInt(zaatarServingsInput.value) || 0,
        cheese: parseInt(cheeseServingsInput.value) || 0,
        cocktail: parseInt(cocktailServingsInput.value) || 0,
        lahme: parseInt(lahmeServingsInput.value) || 0,
        choco: parseInt(chocoServingsInput.value) || 0
      }
    };

    // Step 2: Save to localStorage
    localStorage.setItem("manakishUserRecipe", JSON.stringify(currentRecipe));

    // Step 3: Compress and encode
    const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(currentRecipe));
    const longUrl = `${window.location.origin}${window.location.pathname}?recipe=${compressed}`;
    const encodedUrl = encodeURIComponent(longUrl);

    // Step 4: Shorten with TinyURL
    fetch(`https://tinyurl.com/api-create.php?url=${encodedUrl}`)
      .then(res => res.text())
      .then(shortUrl => {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(shortUrl)
            .then(() => showToast("Recipe link copied to clipboard!"))
            .catch(() => prompt("Copy this recipe link:", shortUrl));
        } else {
          prompt("Copy this recipe link:", shortUrl);
        }
      })
      .catch(err => {
        console.error("Error shortening URL:", err);
        prompt("Could not shorten the link. Here's the full version:", longUrl);
      });

  } catch (err) {
    console.error("shareRecipe error:", err);
    showToast("Something went wrong while sharing.");
  }
}


      function loadRecipeFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const compressedRecipeData = urlParams.get("recipe");

        if (compressedRecipeData) {
          try {
            // Decompress the string using LZString
            const decodedRecipeString =
              LZString.decompressFromEncodedURIComponent(compressedRecipeData);
            if (!decodedRecipeString) {
              // Decompression might return null if input is invalid
              throw new Error("Invalid compressed recipe data.");
            }
            const sharedRecipe = JSON.parse(decodedRecipeString);
            applyRecipe(sharedRecipe);
            localStorage.setItem(
              "manakishUserRecipe",
              JSON.stringify(sharedRecipe)
            );
            // window.history.replaceState({}, document.title, window.location.pathname); // Optional: clean URL
            showToast("Recipe loaded from shared link!");
            return true;
          } catch (error) {
            console.error("Failed to load recipe from URL:", error);
            showToast(
              "Could not load the shared recipe. It might be invalid or corrupted. Loading defaults."
            );
            return false;
          }
        }
        return false;
      }

      function loadSavedRecipe() {
        const savedRecipeString = localStorage.getItem("manakishUserRecipe");
        if (savedRecipeString) {
          try {
            const savedRecipe = JSON.parse(savedRecipeString);
            applyRecipe(savedRecipe);
            return true;
          } catch (error) {
            console.error(
              "Failed to load saved recipe from localStorage:",
              error
            );
            showToast(
              "Could not load saved recipe. It might be corrupted. Loading defaults."
            );
            localStorage.removeItem("manakishUserRecipe");
            return false;
          }
        }
        return false;
      }

      function applyRecipe(recipeObject) {
        doughBallWeightInput.value = recipeObject.doughBallWeight;
        doughBallCountInput.value = recipeObject.doughBallCount;
        numberOfBatchesInput.value = recipeObject.numberOfBatches;

        zaatarServingsInput.value = recipeObject.servings.zaatar;
        cheeseServingsInput.value = recipeObject.servings.cheese;
        cocktailServingsInput.value = recipeObject.servings.cocktail;
        lahmeServingsInput.value = recipeObject.servings.lahme;
        chocoServingsInput.value = recipeObject.servings.choco;

        ingredients = JSON.parse(JSON.stringify(recipeObject.ingredients));
        toppings = JSON.parse(JSON.stringify(recipeObject.toppings));
      }

      function resetToDefaults() {
        if (
          confirm(
            "Are you sure you want to reset everything to default values? This will also clear any saved recipe."
          )
        ) {
          localStorage.removeItem("manakishUserRecipe");

          ingredients = JSON.parse(JSON.stringify(defaultIngredientsData));
          toppings = JSON.parse(JSON.stringify(defaultToppingsData));

          doughBallWeightInput.value = defaultInitialDoughBallWeight;
          doughBallCountInput.value = defaultInitialDoughBallCount;
          numberOfBatchesInput.value = defaultInitialNumberOfBatches;

          zaatarServingsInput.value = defaultInitialServings.zaatar;
          cheeseServingsInput.value = defaultInitialServings.cheese;
          cocktailServingsInput.value = defaultInitialServings.cocktail;
          lahmeServingsInput.value = defaultInitialServings.lahme;
          chocoServingsInput.value = defaultInitialServings.choco;

          loadIngredients();
          loadAllToppings();
          updateCalculations();
          showToast("Calculator has been reset to default values.");
        }
      }
      
      function updatePrintableDoughRecipe() {
  const tbody = document.getElementById("printableDoughBody");
  tbody.innerHTML = "";

  const flour = ingredients.find(i => i.name.toLowerCase() === "flour");
  const flourAmount = flour ? flour.amount : 1; // avoid divide by 0

  ingredients.forEach((ing) => {
    const percent = ((ing.amount / flourAmount) * 100).toFixed(1);
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${ing.name}</td>
      <td>${ing.amount.toFixed(1)}</td>
      <td>${percent}%</td>
    `;
    tbody.appendChild(row);
  });
}


      // --- DOUGH INGREDIENT FUNCTIONS ---
      function loadIngredients() {
        ingredientsList.innerHTML = "";
        ingredients.forEach((ingredient) => {
          const row = document.createElement("tr");
          const idSafeName = ingredient.name.replace(/[^a-zA-Z0-9]/g, "");
          row.innerHTML = `
                      <td>${ingredient.name}</td>
                      <td><input type="number" value="${ingredient.amount}" min="0" step="0.1" id="${idSafeName}BaseAmount" onchange="updateIngredientBaseAmount('${ingredient.name}')"></td>
                      <td id="${idSafeName}CalculatedAmount">${ingredient.amount}g</td>
                      <td id="${idSafeName}BatchAmount">${ingredient.amount}g</td>
                      <td class="price-column"><input type="number" value="${ingredient.price}" min="0" step="0.01" id="${idSafeName}Price" onchange="updateIngredientPrice('${ingredient.name}')"></td>
                      <td><button onclick="removeIngredient('${ingredient.name}')">X</button></td>
                  `;
          ingredientsList.appendChild(row);
        });
      }

      function updateIngredientBaseAmount(ingredientName) {
        const idSafeName = ingredientName.replace(/[^a-zA-Z0-9]/g, "");
        const amountInput = document.getElementById(idSafeName + "BaseAmount");
        const newAmount = parseFloat(amountInput.value);

        const ingredient = ingredients.find((i) => i.name === ingredientName);
        if (ingredient && !isNaN(newAmount) && newAmount >= 0) {
          // Ensure positive amount
          ingredient.amount = newAmount;
        } else if (ingredient) {
          // Reset to old value if invalid
          amountInput.value = ingredient.amount;
        }
        updateCalculations();
      }

      function updateIngredientPrice(ingredientName) {
        const idSafeName = ingredientName.replace(/[^a-zA-Z0-9]/g, "");
        const priceInput = document.getElementById(idSafeName + "Price");
        const newPrice = parseFloat(priceInput.value);

        const ingredient = ingredients.find((i) => i.name === ingredientName);
        if (ingredient && !isNaN(newPrice) && newPrice >= 0) {
          // Ensure positive price
          ingredient.price = newPrice;
        } else if (ingredient) {
          // Reset to old value if invalid
          priceInput.value = ingredient.price;
        }
        updateCalculations();
      }

      function removeIngredient(ingredientName) {
        ingredients = ingredients.filter((i) => i.name !== ingredientName);
        loadIngredients();
        updateCalculations();
      }

      function addIngredient() {
        const newNameInput = document.getElementById("newIngredientName");
        const newAmountInput = document.getElementById("newIngredientAmount");
        const newPriceInput = document.getElementById("newIngredientPrice");

        const newName = newNameInput.value.trim();
        const newAmount = parseFloat(newAmountInput.value);
        const newPrice = parseFloat(newPriceInput.value);

        if (
          newName &&
          !isNaN(newAmount) &&
          newAmount >= 0 &&
          !isNaN(newPrice) &&
          newPrice >= 0
        ) {
          if (
            ingredients.find(
              (ing) => ing.name.toLowerCase() === newName.toLowerCase()
            )
          ) {
            showToast(
              "An ingredient with this name already exists in the dough recipe."
            );
            return;
          }
          ingredients.push({
            name: newName,
            amount: newAmount,
            price: newPrice,
          });
          loadIngredients();
          updateCalculations();
          newNameInput.value = "";
          newAmountInput.value = "";
          newPriceInput.value = "";
        } else {
          showToast(
            "Please enter valid ingredient details (name, non-negative amount, and non-negative price)."
          );
        }
      }

      // --- CORE CALCULATION LOGIC ---
      function updateCalculations() {
        let currentDoughBallWeight = parseFloat(doughBallWeightInput.value);
        let currentDoughBallCount = parseFloat(doughBallCountInput.value);
        let currentNumberOfBatches = parseInt(numberOfBatchesInput.value);

        if (isNaN(currentDoughBallWeight) || currentDoughBallWeight <= 0)
          currentDoughBallWeight = defaultInitialDoughBallWeight;
        if (isNaN(currentDoughBallCount) || currentDoughBallCount <= 0)
          currentDoughBallCount = defaultInitialDoughBallCount;
        if (isNaN(currentNumberOfBatches) || currentNumberOfBatches <= 0)
          currentNumberOfBatches = defaultInitialNumberOfBatches;

        doughBallWeightInput.value = currentDoughBallWeight;
        doughBallCountInput.value = currentDoughBallCount;
        numberOfBatchesInput.value = currentNumberOfBatches;

        calculateRecipe();
        updateToppingsCalculations();
        updateSummary();
        updatePrintableDoughRecipe();

      }

      function calculateRecipe() {
        const currentDoughBallWeight = parseFloat(doughBallWeightInput.value);
        const currentDoughBallCount = parseFloat(doughBallCountInput.value);
        const currentNumberOfBatches = parseInt(numberOfBatchesInput.value);

        const totalDoughWeight = currentDoughBallWeight * currentDoughBallCount;
        const batchWeight = totalDoughWeight / currentNumberOfBatches;

        totalDoughWeightLabel.textContent = totalDoughWeight.toFixed(1);
        batchWeightLabel.textContent = batchWeight.toFixed(1);
        resultDoughBallsLabel.textContent = currentDoughBallCount;
        resultDoughBallWeightLabel.textContent =
          currentDoughBallWeight.toFixed(1);
        batchNumberLabel.textContent = 1;
        totalBatchesLabel.textContent = currentNumberOfBatches;
        toppingsDoughBallsLabel.textContent = currentDoughBallCount;

        let baseTotal = 0;
        let calculatedTotal = 0;
        let batchTotal = 0;
        let doughTotalPriceNum = 0;

        recipeResults.innerHTML = "";
        batchRecipeResults.innerHTML = "";

        const currentSumOfBaseAmounts = ingredients.reduce(
          (sum, ing) => sum + ing.amount,
          0
        );

        ingredients.forEach((ingredient) => {
          const idSafeName = ingredient.name.replace(/[^a-zA-Z0-9]/g, "");
          const baseAmount = ingredient.amount;

          const scalingFactor =
            currentSumOfBaseAmounts > 0
              ? totalDoughWeight / currentSumOfBaseAmounts
              : 0;
          const calculatedAmount = baseAmount * scalingFactor;
          const batchAmount = calculatedAmount / currentNumberOfBatches; // or batchWeight / currentSumOfBaseAmounts * baseAmount
          const ingredientCost = (calculatedAmount / 1000) * ingredient.price;

          baseTotal += baseAmount;
          calculatedTotal += calculatedAmount;
          batchTotal += batchAmount;
          doughTotalPriceNum += ingredientCost;

          const calculatedAmountElem = document.getElementById(
            idSafeName + "CalculatedAmount"
          );
          if (calculatedAmountElem)
            calculatedAmountElem.textContent =
              calculatedAmount.toFixed(1) + "g";

          const batchAmountElem = document.getElementById(
            idSafeName + "BatchAmount"
          );
          if (batchAmountElem)
            batchAmountElem.textContent = batchAmount.toFixed(1) + "g";

          const row = document.createElement("tr");
          row.innerHTML = `
                      <td>${ingredient.name}</td>
                      <td>${calculatedAmount.toFixed(1)}g</td>
                      <td class="price-column">£${ingredientCost.toFixed(
                        2
                      )}</td>
                  `;
          recipeResults.appendChild(row);

          const batchRow = document.createElement("tr");
          batchRow.innerHTML = `
                      <td>${ingredient.name}</td>
                      <td>${batchAmount.toFixed(1)}g</td>
                      <td class="price-column">£${(
                        (batchAmount / 1000) *
                        ingredient.price
                      ).toFixed(2)}</td>
                  `;
          batchRecipeResults.appendChild(batchRow);
        });

        baseTotalLabel.textContent = baseTotal.toFixed(1) + "g";
        calculatedTotalLabel.textContent = calculatedTotal.toFixed(1) + "g";
        batchTotalLabel.textContent = batchTotal.toFixed(1) + "g"; // This should be sum of batch amounts
        doughTotalPriceLabel.textContent = `£${doughTotalPriceNum.toFixed(2)}`;
        resultTotalLabel.textContent = calculatedTotal.toFixed(1) + "g";
        recipeTotalPriceLabel.textContent = `£${doughTotalPriceNum.toFixed(2)}`;
        batchResultTotalLabel.textContent = batchTotal.toFixed(1) + "g";
        batchRecipeTotalPriceLabel.textContent = `£${(
          doughTotalPriceNum / currentNumberOfBatches
        ).toFixed(2)}`;

        const currentFlour = ingredients.find(
          (i) => i.name.toLowerCase() === "flour"
        );
        const currentWater = ingredients.find(
          (i) => i.name.toLowerCase() === "water"
        );

        if (currentFlour && currentFlour.amount > 0 && currentWater) {
          const hydrationRatio =
            (currentWater.amount / currentFlour.amount) * 100;
          let hydrationLevel = "Medium";
          let hydrationClass = "hydration-medium";

          if (hydrationRatio < 60) {
            hydrationLevel = "Low";
            hydrationClass = "hydration-low";
          } else if (hydrationRatio > 70) {
            hydrationLevel = "High";
            hydrationClass = "hydration-high";
          }
          doughHydrationLabel.textContent = hydrationRatio.toFixed(0) + "%";
          hydrationIndicator.textContent = hydrationLevel;
          hydrationIndicator.className = "indicator " + hydrationClass;
        } else {
          doughHydrationLabel.textContent = "N/A";
          hydrationIndicator.textContent = "";
          hydrationIndicator.className = "indicator";
        }
        toggleDoughPricesUI(showPrices);
      }

      // --- TOPPING FUNCTIONS ---
      function loadAllToppings() {
        Object.keys(toppings).forEach((toppingType) =>
          loadToppings(toppingType)
        );
      }

      function loadToppings(toppingType) {
        const ingredientsContainer = document.getElementById(
          toppingType + "Ingredients"
        );
        if (!ingredientsContainer) return;
        ingredientsContainer.innerHTML = "";

        if (!toppings[toppingType]) toppings[toppingType] = [];

        toppings[toppingType].forEach((ingredient) => {
          const row = document.createElement("tr");
          const idSafeName = ingredient.name.replace(/[^a-zA-Z0-9]/g, "");
          const idSafeToppingType = toppingType.replace(/[^a-zA-Z0-9]/g, "");

          row.innerHTML = `
                    <td>${ingredient.name}</td>
                    <td><input type="number" value="${ingredient.amount}" min="0" step="0.1" id="${idSafeToppingType}${idSafeName}Amount" onchange="updateToppingIngredientAmount('${toppingType}', '${ingredient.name}')"></td>
                    <td id="${idSafeToppingType}${idSafeName}TotalAmount">0g</td>
                    <td class="price-column"><input type="number" value="${ingredient.price}" min="0" step="0.01" id="${idSafeToppingType}${idSafeName}Price" onchange="updateToppingIngredientPrice('${toppingType}', '${ingredient.name}')"></td>
                    <td class="price-column" id="${idSafeToppingType}${idSafeName}Cost">£0.00</td>
                    <td><button onclick="removeToppingIngredient('${toppingType}', '${ingredient.name}')">X</button></td>
                `;
          ingredientsContainer.appendChild(row);
        });
      }

      function updateToppingIngredientAmount(toppingType, ingredientName) {
        const idSafeName = ingredientName.replace(/[^a-zA-Z0-9]/g, "");
        const idSafeToppingType = toppingType.replace(/[^a-zA-Z0-9]/g, "");
        const amountInput = document.getElementById(
          idSafeToppingType + idSafeName + "Amount"
        );
        const newAmount = parseFloat(amountInput.value);

        const ingredient = toppings[toppingType].find(
          (i) => i.name === ingredientName
        );
        if (ingredient && !isNaN(newAmount) && newAmount >= 0) {
          ingredient.amount = newAmount;
        } else if (ingredient) {
          amountInput.value = ingredient.amount; // Revert if invalid
        }
        updateToppingsCalculations();
      }

      function updateToppingIngredientPrice(toppingType, ingredientName) {
        const idSafeName = ingredientName.replace(/[^a-zA-Z0-9]/g, "");
        const idSafeToppingType = toppingType.replace(/[^a-zA-Z0-9]/g, "");
        const priceInput = document.getElementById(
          idSafeToppingType + idSafeName + "Price"
        );
        const newPrice = parseFloat(priceInput.value);

        const ingredient = toppings[toppingType].find(
          (i) => i.name === ingredientName
        );
        if (ingredient && !isNaN(newPrice) && newPrice >= 0) {
          ingredient.price = newPrice;
        } else if (ingredient) {
          priceInput.value = ingredient.price; // Revert if invalid
        }
        updateToppingsCalculations();
      }

      function removeToppingIngredient(toppingType, ingredientName) {
        toppings[toppingType] = toppings[toppingType].filter(
          (i) => i.name !== ingredientName
        );
        loadToppings(toppingType);
        updateToppingsCalculations();
      }

      function addToppingIngredient(toppingType) {
        const newNameInput = document.getElementById(
          toppingType + "NewIngredientName"
        );
        const newAmountInput = document.getElementById(
          toppingType + "NewIngredientAmount"
        );
        const newPriceInput = document.getElementById(
          toppingType + "NewIngredientPrice"
        );

        const newName = newNameInput.value.trim();
        const newAmount = parseFloat(newAmountInput.value);
        const newPrice = parseFloat(newPriceInput.value);

        if (
          newName &&
          !isNaN(newAmount) &&
          newAmount >= 0 &&
          !isNaN(newPrice) &&
          newPrice >= 0
        ) {
          if (!toppings[toppingType]) toppings[toppingType] = [];
          if (
            toppings[toppingType].find(
              (ing) => ing.name.toLowerCase() === newName.toLowerCase()
            )
          ) {
            showToast(
              `An ingredient with this name already exists in the ${toppingType} topping.`
            );
            return;
          }
          toppings[toppingType].push({
            name: newName,
            amount: newAmount,
            price: newPrice,
          });
          loadToppings(toppingType);
          updateToppingsCalculations();
          newNameInput.value = "";
          newAmountInput.value = "";
          newPriceInput.value = "";
        } else {
          showToast(
            "Please enter valid ingredient details (name, non-negative amount, and non-negative price)."
          );
        }
      }

      function updateToppingsCalculations() {
        const currentServings = {
          zaatar: parseInt(zaatarServingsInput.value) || 0,
          cheese: parseInt(cheeseServingsInput.value) || 0,
          cocktail: parseInt(cocktailServingsInput.value) || 0,
          lahme: parseInt(lahmeServingsInput.value) || 0,
          choco: parseInt(chocoServingsInput.value) || 0,
        };

        zaatarServingsInput.value = currentServings.zaatar;
        cheeseServingsInput.value = currentServings.cheese;
        cocktailServingsInput.value = currentServings.cocktail;
        lahmeServingsInput.value = currentServings.lahme;
        chocoServingsInput.value = currentServings.choco;

        Object.keys(toppings).forEach((toppingType) => {
          calculateToppingCost(toppingType, currentServings[toppingType] || 0);
        });

        let allToppingsCostNum = 0;
        Object.keys(toppings).forEach((toppingType) => {
          allToppingsCostNum +=
            parseFloat(
              document
                .getElementById(toppingType + "TotalPrice")
                .textContent.replace("£", "")
            ) || 0;
        });
        allToppingsCostLabel.textContent = `£${allToppingsCostNum.toFixed(2)}`;

        const totalManakishInToppings = Object.values(currentServings).reduce(
          (sum, count) => sum + count,
          0
        );
        const currentDoughBallCountVal = parseFloat(doughBallCountInput.value);
        toppingsMismatchWarning.style.display =
          totalManakishInToppings !== currentDoughBallCountVal
            ? "block"
            : "none";

        updateSummary();
        toggleToppingPricesUI(showPrices);
      }

      function calculateToppingCost(toppingType, numServings) {
        let totalAmount = 0;
        let totalPrice = 0;
        const idSafeToppingType = toppingType.replace(/[^a-zA-Z0-9]/g, "");

        if (!toppings[toppingType]) return;

        toppings[toppingType].forEach((ingredient) => {
          const idSafeName = ingredient.name.replace(/[^a-zA-Z0-9]/g, "");
          const amountPerManakish = ingredient.amount;
          const totalIngredientAmount = amountPerManakish * numServings;
          const ingredientCost =
            (totalIngredientAmount / 1000) * ingredient.price;

          totalAmount += totalIngredientAmount;
          totalPrice += ingredientCost;

          const totalAmountElem = document.getElementById(
            idSafeToppingType + idSafeName + "TotalAmount"
          );
          if (totalAmountElem)
            totalAmountElem.textContent =
              totalIngredientAmount.toFixed(1) + "g";

          const costElem = document.getElementById(
            idSafeToppingType + idSafeName + "Cost"
          );
          if (costElem) costElem.textContent = `£${ingredientCost.toFixed(2)}`;
        });

        const toppingTotalAmountElem = document.getElementById(
          toppingType + "TotalAmount"
        );
        if (toppingTotalAmountElem)
          toppingTotalAmountElem.textContent = totalAmount.toFixed(1) + "g";

        const toppingTotalPriceElem = document.getElementById(
          toppingType + "TotalPrice"
        );
        if (toppingTotalPriceElem)
          toppingTotalPriceElem.textContent = `£${totalPrice.toFixed(2)}`;
      }

      // --- SUMMARY FUNCTIONS ---
      function updateSummary() {
        const currentDoughBallCountVal = parseFloat(doughBallCountInput.value);
        summaryDoughCostLabel.textContent = recipeTotalPriceLabel.textContent;
        summaryDoughBallsLabel.textContent = currentDoughBallCountVal;

        const currentServings = {
          zaatar: parseInt(zaatarServingsInput.value) || 0,
          cheese: parseInt(cheeseServingsInput.value) || 0,
          cocktail: parseInt(cocktailServingsInput.value) || 0,
          lahme: parseInt(lahmeServingsInput.value) || 0,
          choco: parseInt(chocoServingsInput.value) || 0,
        };

        summaryZaatarCostLabel.textContent =
          document.getElementById("zaatarTotalPrice").textContent;
        summaryZaatarCountLabel.textContent = currentServings.zaatar;
        summaryCheesesCostLabel.textContent =
          document.getElementById("cheeseTotalPrice").textContent;
        summaryCheeseCountLabel.textContent = currentServings.cheese;
        summaryCocktailCostLabel.textContent =
          document.getElementById("cocktailTotalPrice").textContent;
        summaryCocktailCountLabel.textContent = currentServings.cocktail;
        summaryLahmeCostLabel.textContent =
          document.getElementById("lahmeTotalPrice").textContent;
        summaryLahmeCountLabel.textContent = currentServings.lahme;
        summaryChocoCostLabel.textContent =
          document.getElementById("chocoTotalPrice").textContent;
        summaryChocoCountLabel.textContent = currentServings.choco;

        const totalManakishSummary = Object.values(currentServings).reduce(
          (sum, count) => sum + count,
          0
        );
        summaryTotalCountLabel.textContent = totalManakishSummary;

        const totalDoughCostNum =
          parseFloat(recipeTotalPriceLabel.textContent.replace("£", "")) || 0;
        const totalToppingsCostNum =
          parseFloat(allToppingsCostLabel.textContent.replace("£", "")) || 0;
        const grandTotalCost = totalDoughCostNum + totalToppingsCostNum;
        summaryTotalCostLabel.textContent = `£${grandTotalCost.toFixed(2)}`;

        const costPerManakishNum =
          totalManakishSummary > 0 ? grandTotalCost / totalManakishSummary : 0;
        costPerManakishLabel.textContent = `£${costPerManakishNum.toFixed(2)}`;

        generateShoppingList();
      }

      function generateShoppingList() {
        shoppingListElem.innerHTML = "";
        const ingredientsMap = new Map();
        const currentDoughBallWeightVal = parseFloat(
          doughBallWeightInput.value
        );
        const currentDoughBallCountVal = parseFloat(doughBallCountInput.value);
        const totalDoughWeightForShopping =
          currentDoughBallWeightVal * currentDoughBallCountVal;
        const currentSumOfBaseAmounts = ingredients.reduce(
          (sum, ing) => sum + ing.amount,
          0
        );

        ingredients.forEach((ingredient) => {
          const scalingFactor =
            currentSumOfBaseAmounts > 0
              ? totalDoughWeightForShopping / currentSumOfBaseAmounts
              : 0;
          const amount = ingredient.amount * scalingFactor;
          const price = (amount / 1000) * ingredient.price;
          addToIngredientsMap(ingredientsMap, ingredient.name, amount, price);
        });

        const currentServings = {
          zaatar: parseInt(zaatarServingsInput.value) || 0,
          cheese: parseInt(cheeseServingsInput.value) || 0,
          cocktail: parseInt(cocktailServingsInput.value) || 0,
          lahme: parseInt(lahmeServingsInput.value) || 0,
          choco: parseInt(chocoServingsInput.value) || 0,
        };
        Object.keys(toppings).forEach((toppingType) => {
          if (!toppings[toppingType]) return;
          toppings[toppingType].forEach((ingredient) => {
            const amountPerManakish = ingredient.amount;
            const totalIngredientAmount =
              amountPerManakish * (currentServings[toppingType] || 0);
            const price = (totalIngredientAmount / 1000) * ingredient.price;
            addToIngredientsMap(
              ingredientsMap,
              ingredient.name,
              totalIngredientAmount,
              price
            );
          });
        });

        const sortedIngredients = Array.from(ingredientsMap.entries()).sort(
          (a, b) => a[0].localeCompare(b[0])
        );
        let totalShoppingCost = 0;

        sortedIngredients.forEach(([name, data]) => {
          const row = document.createElement("tr");
          let displayAmount = `${data.amount.toFixed(1)}g`;
          if (data.amount >= 1000) {
            displayAmount = `${(data.amount / 1000).toFixed(2)}kg`;
          }
          row.innerHTML = `
                      <td>${name}</td>
                      <td>${displayAmount}</td>
                      <td class="price-column">£${data.price.toFixed(2)}</td>
                  `;
          shoppingListElem.appendChild(row);
          totalShoppingCost += data.price;
        });
        shoppingListTotalLabel.textContent = `£${totalShoppingCost.toFixed(2)}`;
        // Ensure shopping list prices are also toggled correctly
        toggleShoppingListPricesUI(showPrices);
      }

      function addToIngredientsMap(map, name, amount, price) {
        if (map.has(name)) {
          const existing = map.get(name);
          existing.amount += amount;
          existing.price += price;
        } else {
          map.set(name, { amount, price });
        }
      }

      // --- PRICE VISIBILITY TOGGLE ---
      function toggleDoughPrices() {
        showPrices = !showPrices;
        applyPriceVisibility(showPrices);
      }
      function toggleToppingPrices() {
        showPrices = !showPrices;
        applyPriceVisibility(showPrices);
      }

      function applyPriceVisibility(shouldShow) {
        toggleDoughPricesUI(shouldShow);
        toggleToppingPricesUI(shouldShow);
        toggleSummaryPricesUI(shouldShow);
        toggleShoppingListPricesUI(shouldShow);
        toggleDoughPricesButton.textContent = shouldShow
          ? "Hide Prices"
          : "Show Prices";
        toggleToppingPricesButton.textContent = shouldShow
          ? "Hide Prices"
          : "Show Prices";
      }

      function toggleDoughPricesUI(shouldShow) {
        const displayValue = shouldShow ? "" : "table-cell"; // Use table-cell for proper column display
        document
          .querySelectorAll(
            "#ingredientsTable .price-column, #recipeResults .price-column, #batchRecipeResults .price-column"
          )
          .forEach((column) => {
            column.style.display = shouldShow ? displayValue : "none";
          }); // Ensure header and cells are hidden
        document.getElementById("doughTotalPrice").style.display = shouldShow
          ? ""
          : "none";
        document.getElementById("recipeTotalPrice").style.display = shouldShow
          ? ""
          : "none";
        document.getElementById("batchRecipeTotalPrice").style.display =
          shouldShow ? "" : "none";
      }

      function toggleToppingPricesUI(shouldShow) {
        const displayValue = shouldShow ? "" : "table-cell";
        document
          .querySelectorAll("#toppingsTab .price-column")
          .forEach((column) => {
            column.style.display = shouldShow ? displayValue : "none";
          });
        document
          .querySelectorAll(
            "#toppingsTab [id$='TotalPrice'], #toppingsTab [id$='Cost'].price-column"
          )
          .forEach((e) => {
            e.style.display = shouldShow ? "" : "none";
          });
        allToppingsCostLabel.style.display = shouldShow ? "" : "none";
      }

      function toggleSummaryPricesUI(shouldShow) {
        const displayValue = shouldShow ? "" : "none";
        document.getElementById("summaryDoughCost").style.display =
          displayValue;
        document.getElementById("summaryZaatarCost").style.display =
          displayValue;
        document.getElementById("summaryCheesesCost").style.display =
          displayValue;
        document.getElementById("summaryCocktailCost").style.display =
          displayValue;
        document.getElementById("summaryLahmeCost").style.display =
          displayValue;
        document.getElementById("summaryChocoCost").style.display =
          displayValue;
        document.getElementById("summaryTotalCost").style.display =
          displayValue;
        costPerManakishLabel.parentNode.style.display = displayValue;
      }

      function toggleShoppingListPricesUI(shouldShow) {
        const displayValue = shouldShow ? "" : "table-cell";
        const shoppingListTable = document
          .getElementById("shoppingList")
          .closest("table");
        if (shoppingListTable) {
          shoppingListTable
            .querySelectorAll("tr > td:last-child, tr > th:last-child")
            .forEach(
              (el) => (el.style.display = shouldShow ? displayValue : "none")
            );
        }
        document.getElementById("shoppingListTotal").style.display = shouldShow
          ? ""
          : "none";
      }

      function showToast(message, duration = 3000) {
        const toast = document.getElementById("toast");
        if (!toast) return;

        toast.textContent = message;
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
        }, duration);
      }
    </script>

    <footer
      style="
        text-align: center;
        margin-top: 50px;
        padding-top: 20px;
        font-size: 12px;
        color: #777;
        border-top: 1px solid #eee;
      "
    >
      © 2025 Rany Bechara. All rights reserved.
    </footer>
    <div id="toast" class="toast">Toast Message</div>
  </body>
</html>
